<h1>ショッピングカート</h1>

<% if @cart_items.present? %>
	<%= link_to "カートを空にする", '/cart_items/', method: :delete %>

	<table>
		<thead>
			<tr>
				<th>商品名</th>
				<th>単価（税込）</th>
				<th>数量</th>
				<th>小計</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			<% total = 0 %>
			<% @cart_items.each do |cart_item| %>
			<tr>
					<td>
						<%= attachment_image_tag(cart_item.product, :image, :fill,50,50, fallback: "no_image.jpg", size:'50x50') %>
						<%= cart_item.product.name %>
					</td>
					<td><%= include_tax(cart_item.product.tax_excluded_price).to_i %></td>
					<%= form_for(cart_item) do |f| %>
						<td><%= f.number_field :quantity, value: cart_item.quantity, min: 0, max: 99 %>
							<%= f.submit "変更" %>
							<% end %>
					</td>

					<td><%= subtotal = cart_item.quantity.to_i * include_tax(cart_item.product.tax_excluded_price).to_i %></td>
					<td><%= link_to "削除", cart_item_path(cart_item), method: :delete %></td>
			</tr>
			<% total += subtotal %>
			<% end %>
		</tbody>
	</table>

<p>合計金額</p>
<%= total %>

<%= link_to "買い物を続ける", products_path %>
<%= link_to "情報入力に進む", new_order_path %>

<% else %>
	<p>カートは空です</p>
<% end %>
